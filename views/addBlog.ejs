<!DOCTYPE html>
<html lang="en">
<head>
<%- include('./partials/head') %>
<title>Write New Blog - BlogX</title>
</head>
<body>
<div class="bg-animation">
  <div class="bg-animation-overlay"></div>
</div>
<div class="particle"></div>
<div class="particle"></div>
<div class="particle"></div>
<div class="particle"></div>
<div class="particle"></div>

<%- include('./partials/nav') %>

<section class="page-section">
  <div class="container">
  <div class="card">
    <% if (locals.error) { %>
      <div class="alert alert-danger" role="alert">
        <i class="fas fa-exclamation-triangle"></i>
        <%= locals.error %>
      </div>
    <% } %>

    <form action="/blog" method="post" enctype="multipart/form-data" id="blogForm" class="space-y-4">
      <div>
        <label for="coverImage" class="form-label">
          <i class="fas fa-image"></i> Cover Image (Optional)
        </label>
        <div class="file-upload-area glass text-center cursor-pointer" onclick="document.getElementById('coverImage').click()">
          <i class="fas fa-cloud-upload-alt text-2xl"></i>
          <div class="file-upload-text mt-2">
            <strong>Click to upload</strong> or drag and drop<br>
            <small>PNG, JPG, GIF up to 5MB</small>
          </div>
        </div>
        <input type="file" name="coverImage" class="form-control d-none" id="coverImage" accept="image/*" onchange="previewImage(this)">
        <img id="imagePreview" class="image-preview d-none mt-4" alt="Preview">
      </div>

      <div>
        <label for="title" class="form-label">
          <i class="fas fa-heading"></i> Blog Title
        </label>
        <input 
          type="text" 
          name="title" 
          class="form-control" 
          id="title" 
          placeholder="Enter an engaging title for your blog..."
          required
          maxlength="200"
        >
        <small class="text-muted">Maximum 200 characters</small>
      </div>

      <div>
        <label for="body" class="form-label">
          <i class="fas fa-align-left"></i> Blog Content
        </label>
        <textarea 
          name="body" 
          class="form-control" 
          id="body" 
          rows="15" 
          placeholder="Write your blog content here... Share your thoughts, experiences, and insights with the world!"
          required
        ></textarea>
        <small class="text-muted">Minimum 50 characters</small>
      </div>

      <div class="form-actions flex gap-4 justify-end mt-6">
        <a href="/" class="btn btn-ghost"><i class="fas fa-times mr-2"></i> Cancel</a>
        <button class="btn btn-primary" type="submit" id="submitBtn"> <i class="fas fa-paper-plane mr-2"></i> Publish Blog</button>
      </div>
    </form>
  </div>
  </div>
</section>

<%- include('./partials/scripts') %>

<script>
// Image preview functionality
function previewImage(input) {
  const preview = document.getElementById('imagePreview');
  const uploadArea = document.querySelector('.file-upload-area');
  
  if (input.files && input.files[0]) {
    const reader = new FileReader();
    
    reader.onload = function(e) {
      preview.src = e.target.result;
      preview.classList.remove('d-none');
      uploadArea.style.display = 'none';
    };
    
    reader.readAsDataURL(input.files[0]);
  }
}

// Form validation and submission
document.getElementById('blogForm').addEventListener('submit', function(e) {
  const title = document.getElementById('title').value.trim();
  const body = document.getElementById('body').value.trim();
  const submitBtn = document.getElementById('submitBtn');
  
  if (title.length < 5) {
    e.preventDefault();
    alert('Title must be at least 5 characters long');
    return;
  }
  
  if (body.length < 5) {
    e.preventDefault();
    alert('Blog content must be at least 50 characters long');
    return;
  }
  
  // Show loading state
  submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Publishing...';
  submitBtn.disabled = true;
});

// Character counter for title
document.getElementById('title').addEventListener('input', function() {
  const maxLength = 200;
  const currentLength = this.value.length;
  const remaining = maxLength - currentLength;
  
  if (remaining < 20) {
    this.style.borderColor = '#dc3545';
  } else {
    this.style.borderColor = '#e9ecef';
  }
});

// Character counter for body
document.getElementById('body').addEventListener('input', function() {
  const minLength = 50;
  const currentLength = this.value.length;
  
  if (currentLength < minLength) {
    this.style.borderColor = 'rgba(220, 38, 38, 0.75)';
  } else {
    this.style.borderColor = 'rgba(255, 255, 255, 0.15)';
  }
});
</script>
</body>
</html>