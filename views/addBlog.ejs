<!DOCTYPE html>
<html lang="en">
<head>
<%- include('./partials/head') %>
<title>Write New Blog - BlogX</title>
<style>
body {
  background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
  min-height: 100vh;
}

.page-header {
  background: linear-gradient(135deg, #6c757d 0%, #adb5bd 50%, #868e96 100%);
  color: white;
  padding: 3rem 0;
  margin-bottom: 3rem;
}

.page-header h1 {
  font-size: 2.5rem;
  font-weight: 700;
  margin-bottom: 0.5rem;
}

.page-header p {
  font-size: 1.1rem;
  opacity: 0.9;
}

.blog-form-container {
  background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
  border-radius: 15px;
  box-shadow: 0 8px 25px rgba(0,0,0,0.08);
  padding: 3rem;
  margin-bottom: 3rem;
  border: 1px solid rgba(108, 117, 125, 0.1);
}

.form-label {
  font-weight: 600;
  color: #2c3e50;
  margin-bottom: 0.8rem;
  font-size: 1rem;
}

.form-control {
  border: 2px solid #e9ecef;
  border-radius: 10px;
  padding: 1rem;
  font-size: 1rem;
  transition: all 0.3s ease;
}

.form-control:focus {
  border-color: #6c757d;
  box-shadow: 0 0 0 0.2rem rgba(108, 117, 125, 0.25);
  outline: none;
}

.form-control::placeholder {
  color: #6c757d;
}

textarea.form-control {
  min-height: 200px;
  resize: vertical;
}

.btn {
  --button_radius: 0.70em;
  --button_color: #adb5bd;
  --button_outline_color: #6c757d;
  font-size: 17px;
  font-weight: bold;
  border: none;
  cursor: pointer;
  border-radius: var(--button_radius);
  background: var(--button_outline_color);
  padding: 0;
  transition: all 0.3s ease;
  text-decoration: none;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
}

.btn:hover {
  transform: translateY(-2px);
}

.btn .button_top {
  display: block;
  box-sizing: border-box;
  border: 2px solid var(--button_outline_color);
  border-radius: var(--button_radius);
  padding: 0.7em 1.2em;
  background: var(--button_color);
  color: white;
  transform: translateY(-0.2em);
  transition: transform 0.1s ease;
  text-decoration: none;
}

.btn:hover .button_top {
  transform: translateY(-0.33em);
  background: #868e96;
}

.btn:active .button_top {
  transform: translateY(0);
}

.btn-secondary {
  --button_color: #6c757d;
}

.btn-secondary:hover .button_top {
  background: #495057;
}

.file-upload-area {
  border: 2px dashed #dee2e6;
  border-radius: 10px;
  padding: 2rem;
  text-align: center;
  transition: all 0.3s ease;
  background: #f8f9fa;
}

.file-upload-area:hover {
  border-color: #667eea;
  background: #f0f2ff;
}

.file-upload-area i {
  font-size: 3rem;
  color: #6c757d;
  margin-bottom: 1rem;
}

.file-upload-text {
  color: #6c757d;
  font-size: 1rem;
}

.file-upload-text strong {
  color: #667eea;
}

.image-preview {
  max-width: 100%;
  max-height: 300px;
  border-radius: 10px;
  margin-top: 1rem;
  box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}

.form-actions {
  display: flex;
  gap: 1rem;
  justify-content: flex-end;
  margin-top: 2rem;
}

@media (max-width: 768px) {
  .blog-form-container {
    padding: 2rem 1.5rem;
  }
  
  .form-actions {
    flex-direction: column;
  }
  
  .page-header h1 {
    font-size: 2rem;
  }
}
</style>
</head>
<body>
<%- include('./partials/nav') %>

<!-- Page Header -->
<div class="page-header">
  <div class="container">
    <h1><i class="fas fa-pen-fancy"></i> Write New Blog</h1>
    <p>Share your thoughts, stories, and ideas with the world</p>
  </div>
</div>

<div class="container">
  <div class="blog-form-container">
    <!-- Error Display -->
    <% if (locals.error) { %>
      <div class="alert alert-danger" role="alert">
        <i class="fas fa-exclamation-triangle"></i>
        <%= locals.error %>
      </div>
    <% } %>

    <!-- Blog Form -->
    <form action="/blog" method="post" enctype="multipart/form-data" id="blogForm">
      <!-- Cover Image Upload -->
      <div class="mb-4">
        <label for="coverImage" class="form-label">
          <i class="fas fa-image"></i> Cover Image (Optional)
        </label>
        <div class="file-upload-area" onclick="document.getElementById('coverImage').click()">
          <i class="fas fa-cloud-upload-alt"></i>
          <div class="file-upload-text">
            <strong>Click to upload</strong> or drag and drop<br>
            <small>PNG, JPG, GIF up to 5MB</small>
          </div>
        </div>
        <input type="file" name="coverImage" class="form-control d-none" id="coverImage" accept="image/*" onchange="previewImage(this)">
        <img id="imagePreview" class="image-preview d-none" alt="Preview">
      </div>

      <!-- Blog Title -->
      <div class="mb-4">
        <label for="title" class="form-label">
          <i class="fas fa-heading"></i> Blog Title
        </label>
        <input 
          type="text" 
          name="title" 
          class="form-control" 
          id="title" 
          placeholder="Enter an engaging title for your blog..."
          required
          maxlength="200"
        >
        <small class="text-muted">Maximum 200 characters</small>
      </div>

      <!-- Blog Content -->
      <div class="mb-4">
        <label for="body" class="form-label">
          <i class="fas fa-align-left"></i> Blog Content
        </label>
        <textarea 
          name="body" 
          class="form-control" 
          id="body" 
          rows="15" 
          placeholder="Write your blog content here... Share your thoughts, experiences, and insights with the world!"
          required
        ></textarea>
        <small class="text-muted">Minimum 50 characters</small>
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        <a href="/" class="btn btn-secondary">
          <span class="button_top">
            <i class="fas fa-times"></i> Cancel
          </span>
        </a>
        <button class="btn" type="submit" id="submitBtn">
          <span class="button_top">
            <i class="fas fa-paper-plane"></i> Publish Blog
          </span>
        </button>
      </div>
    </form>
  </div>
</div>

<%- include('./partials/scripts') %>

<script>
// Image preview functionality
function previewImage(input) {
  const preview = document.getElementById('imagePreview');
  const uploadArea = document.querySelector('.file-upload-area');
  
  if (input.files && input.files[0]) {
    const reader = new FileReader();
    
    reader.onload = function(e) {
      preview.src = e.target.result;
      preview.classList.remove('d-none');
      uploadArea.style.display = 'none';
    };
    
    reader.readAsDataURL(input.files[0]);
  }
}

// Form validation and submission
document.getElementById('blogForm').addEventListener('submit', function(e) {
  const title = document.getElementById('title').value.trim();
  const body = document.getElementById('body').value.trim();
  const submitBtn = document.getElementById('submitBtn');
  
  if (title.length < 5) {
    e.preventDefault();
    alert('Title must be at least 5 characters long');
    return;
  }
  
  if (body.length < 5) {
    e.preventDefault();
    alert('Blog content must be at least 50 characters long');
    return;
  }
  
  // Show loading state
  submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Publishing...';
  submitBtn.disabled = true;
});

// Character counter for title
document.getElementById('title').addEventListener('input', function() {
  const maxLength = 200;
  const currentLength = this.value.length;
  const remaining = maxLength - currentLength;
  
  if (remaining < 20) {
    this.style.borderColor = '#dc3545';
  } else {
    this.style.borderColor = '#e9ecef';
  }
});

// Character counter for body
document.getElementById('body').addEventListener('input', function() {
  const minLength = 50;
  const currentLength = this.value.length;
  
  if (currentLength < minLength) {
    this.style.borderColor = '#dc3545';
  } else {
    this.style.borderColor = '#e9ecef';
  }
});
</script>
</body>
</html>